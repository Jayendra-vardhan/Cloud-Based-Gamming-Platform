<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Sync Client</title>
<style>
  body {
    font-family: Arial, sans-serif;
  }
  #video-container {
    max-width: 640px;
    margin: 0 auto;
  }
  video {
    width: 100%;
    height: auto;
  }
</style>
</head>
<body>
<div id="video-container">
  <input type="file" id="video-file" accept="video/*">
  <video controls id="video-player">
    Your browser does not support the video tag.
  </video>
</div>

<script>
  const videoFileInput = document.getElementById('video-file');
  const videoPlayer = document.getElementById('video-player');

  let playState = false;
  let timestamp = 0;
  let clientId = null;

  const ws = new WebSocket('ws://localhost:8080');

  ws.onmessage = function(event) {
    const data = JSON.parse(event.data);
    if (data.clientId) {
      clientId = data.clientId;
      console.log('Connected with ID:', clientId);
    } else {
      playState = data.playState;
      timestamp = data.timestamp;
      updatePlayer();
    }
  };

  videoFileInput.addEventListener('change', function() {
    const file = this.files[0];
    const fileURL = URL.createObjectURL(file);
    videoPlayer.src = fileURL;
  });

  videoPlayer.addEventListener('play', function() {
    playState = true;
    updateServer('playState', true);
  });

  videoPlayer.addEventListener('pause', function() {
    playState = false;
    updateServer('playState', false);
  });

  videoPlayer.addEventListener('timeupdate', function() {
    timestamp = Math.floor(videoPlayer.currentTime);
    updateServer('timestamp', timestamp);
  });

  function updatePlayer() {
    if (playState) {
      videoPlayer.play();
    } else {
      videoPlayer.pause();
    }
    videoPlayer.currentTime = timestamp;
  }

  function updateServer(type, value) {
    if (clientId) {
      ws.send(JSON.stringify({ clientId, type, value }));
    }
  }
</script>
</body>
</html>